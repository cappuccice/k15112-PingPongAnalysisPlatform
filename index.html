<!DOCTYPE html>
<html lang="ja">
 <head>
  <meta charset="utf-8">
  <title>table_tennis</title>
  <link rel="stylesheet" href="table_tennis.css">
  <header>PPAP</header>
  <!-- jqueryの読み込み-->
  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
  <!-- table2csvの読み込み -->
  <script>
  var tableToCSV = {
    export: function(elm /*, delimiter */) {
      var table = elm;
      var rows  = this.getRows(table);
      var lines = [];
      var delimiter = delimiter || ',';

      for (var i = 0, numOfRows = rows.length; i < numOfRows; i++) {
        var cols    = this.getCols(rows[i]);
        var line = [];

        for (var j = 0, numOfCols = cols.length; j < numOfCols; j++) {
            var text = cols[j].textContent || cols[j].innerText;
            text = '"'+text.replace(/"/g, '""')+'"';

            line.push(text);
        }

        lines.push(line.join(delimiter));
      }

      this.saveAsFile(lines.join("\r\n"));
    },

    saveAsFile: function(csv) {
      var blob = new Blob([csv], {type: 'text/csv'});
      var url  = URL.createObjectURL(blob);

      var a = document.createElement("a");

      a.href = url;
      a.target = '_blank';
      a.download = 'table.csv';

      a.click();
    },

    getRows: function(elm){
      return Util.getNodesByName(elm, 'tr');
    },

    getCols: function(elm){
      return Util.getNodesByName(elm, ['td', 'th']);
    }
  }

  var Util = {
    getNodesByName: function(elm /*, string or array*/) {
      var children  = elm.childNodes;
      var nodeNames = ('string' === typeof arguments[1]) ? [arguments[1]] : arguments[1] ;
      nodeNames = nodeNames.map(function(str){ return str.toLowerCase() });

      var results  = [];

      for (var i = 0, max = children.length; i < max; i++ ) {
        if (nodeNames.indexOf(children[i].nodeName.toLowerCase()) !== -1)
        {
           results.push(children[i]);
        }
        else
        {
           results = results.concat(this.getNodesByName(children[i], nodeNames));
        }
      }

      return results;
    }
  }

  window.onload = function(){
    document.getElementById('download').addEventListener('click', function (e){ e.preventDefault(); tableToCSV.export(document.getElementById('scoreTable')); });
  }

  </script>
 </head>
 <body>
  <div id="page">
    <div class="page-left">
      <div class="youtube">
        <input type="text" id="url" name="url" size=85>
        <button type="button" name="table_tennis" value="table_tennis" onclick="movieChange()">
          <font size="2">送信</font>
        </button>
      </div>
      <div class="movie">
        <div class="inner_movie">
          <iframe id="movie_src" width="560" height="315" src="https://www.youtube.com/embed/NSUhUugvPBU?ecver=1" frameborder="0" allowfullscreen></iframe>
        </div>
      </div>
      <div class="page-left">
          <img id = "PPAP"　src="PPAPS.jpg" alt="howto" >
      </div>
      <div class="page-right">
        <table id="scoreTable">
          <thead id="inputhead">
            <tr id="oppai">
              <th colspan="1">player</th>
              <th colspan="4">service</th>
              <th colspan="4">receive</th>
              <th colspan="1">winner</th>
            </tr>
            <tr id="oppai2">
              <th>player</th>
              <th>service</th>
              <th>s_style</th>
              <th>s_pos</th>
              <th>s_racket</th>
              <th>receive</th>
              <th>r_style</th>
              <th>r_pos</th>
              <th>r_racket</th>
              <th>winner</th>
            </tr>
            <tr id="oppai3">
              <th><input type="text" size="9" id="player" value=""></th>
              <!--th><input type="text" size="6" id="net" value=""></th-->
              <th><input type="text" size="10" id="service" value=""></th>
              <th><input type="text" size="10" id="s_style" value=""></th>
              <th><input type="text" size="8" id="s_pos" value=""></th>
              <th><input type="text" size="6" id="s_racket" value=""></th>
              <th><input type="text" size="8" id="receive" value=""></th>
              <th><input type="text" size="10" id="r_style" value=""></th>
              <th><input type="text" size="8" id="r_pos" value=""></th>
              <th><input type="text" size="6" id="r_racket" value=""></th>
              <th><input type="text" size="6" id="winner" value=""></th>
            </tr>
          </thead>
          <tbody id="table_body">
            <tr>
            </tr>
          </tbody>
        </table>
        <a href="#" id="download">CSVダウンロード</a>
      </div>
    </div>
  </div>
  <!-- .page -->
  <script src="table_tennis.js"></script>
 </body>
</html>
